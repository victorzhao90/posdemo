 1. ç›®å½•ç»“æ„
bash
Copy
Edit
backend-springboot/
â”‚â”€â”€ src/main/java/com/example/pos
â”‚   â”œâ”€â”€ controller
â”‚   â”‚   â”œâ”€â”€ QuestionController.java      # å¤„ç†é—®é¢˜çš„ API
â”‚   â”‚   â”œâ”€â”€ AnswerController.java        # å¤„ç† POS æœºå›ç­”
â”‚   â”œâ”€â”€ model
â”‚   â”‚   â”œâ”€â”€ Question.java                # é—®é¢˜æ¨¡å‹
â”‚   â”œâ”€â”€ service
â”‚   â”‚   â”œâ”€â”€ QuestionService.java         # æä¾›é—®é¢˜çš„é€»è¾‘
â”‚   â”œâ”€â”€ Application.java                 # å¯åŠ¨ç±»
â”‚â”€â”€ src/main/resources
â”‚   â”œâ”€â”€ questions.json                   # é¢„è®¾é—®é¢˜ï¼ˆæ¨¡æ‹Ÿæ•°æ®åº“ï¼‰
â”‚â”€â”€ pom.xml
ğŸ”¹ 2. åˆ›å»º questions.json
æ¨¡æ‹Ÿæ•°æ®åº“ï¼Œå­˜å‚¨é—®é¢˜ï¼š

json
Copy
Edit
[
  { "id": 1, "content": "è¯·ç¡®è®¤æ‚¨çš„å§“åæ˜¯å¦æ­£ç¡®ï¼Ÿ", "field": "name" },
  { "id": 2, "content": "è¯·ç¡®è®¤æ‚¨çš„åœ°å€æ˜¯å¦æ­£ç¡®ï¼Ÿ", "field": "address" },
  { "id": 3, "content": "è¯·ç¡®è®¤æ‚¨çš„å›½ç±æ˜¯å¦æ­£ç¡®ï¼Ÿ", "field": "nationality" }
]
ğŸ”¹ 3. åˆ›å»º Question æ¨¡å‹
Question.java

java
Copy
Edit
package com.example.pos.model;

public class Question {
    private int id;
    private String content;
    private String field; // å…³è”å­—æ®µï¼Œä¾‹å¦‚ "name", "address"

    // æ„é€ æ–¹æ³•
    public Question() {}
    
    public Question(int id, String content, String field) {
        this.id = id;
        this.content = content;
        this.field = field;
    }

    // Getter å’Œ Setter
    public int getId() { return id; }
    public void setId(int id) { this.id = id; }

    public String getContent() { return content; }
    public void setContent(String content) { this.content = content; }

    public String getField() { return field; }
    public void setField(String field) { this.field = field; }
}
ğŸ”¹ 4. QuestionService åªè¿”å›ä¸€ä¸ªé—®é¢˜
QuestionService.java

java
Copy
Edit
package com.example.pos.service;

import com.example.pos.model.Question;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.stereotype.Service;

import javax.annotation.PostConstruct;
import java.io.InputStream;
import java.util.List;
import java.util.Optional;
import java.util.concurrent.atomic.AtomicInteger;

@Service
public class QuestionService {
    private List<Question> questions;
    private AtomicInteger currentIndex = new AtomicInteger(0);

    @PostConstruct
    public void loadQuestions() {
        ObjectMapper objectMapper = new ObjectMapper();
        try (InputStream inputStream = getClass().getResourceAsStream("/questions.json")) {
            questions = objectMapper.readValue(inputStream, new TypeReference<List<Question>>() {});
        } catch (Exception e) {
            throw new RuntimeException("æ— æ³•åŠ è½½é—®é¢˜æ•°æ®", e);
        }
    }

    public Optional<Question> getNextQuestion() {
        int index = currentIndex.getAndIncrement();
        if (index < questions.size()) {
            return Optional.of(questions.get(index));
        } else {
            return Optional.empty(); // æ²¡æœ‰æ›´å¤šé—®é¢˜
        }
    }

    public void resetQuestions() {
        currentIndex.set(0); // é‡æ–°å¼€å§‹é—®é¢˜
    }
}
ğŸ”¹ 5. QuestionController æä¾›é—®é¢˜
QuestionController.java

java
Copy
Edit
package com.example.pos.controller;

import com.example.pos.model.Question;
import com.example.pos.service.QuestionService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.messaging.simp.SimpMessagingTemplate;
import org.springframework.web.bind.annotation.*;

import java.util.Optional;

@RestController
@RequestMapping("/api/question")
public class QuestionController {

    @Autowired
    private QuestionService questionService;

    @Autowired
    private SimpMessagingTemplate messagingTemplate;

    @GetMapping("/next")
    public Question getNextQuestion() {
        Optional<Question> question = questionService.getNextQuestion();
        return question.orElse(new Question(0, "æ‰€æœ‰é—®é¢˜å·²å®Œæˆ", ""));
    }

    @PostMapping("/reset")
    public void resetQuestions() {
        questionService.resetQuestions();
    }
}
ğŸ”¹ 6. AnswerController å¤„ç† POS æœºå›ç­”
AnswerController.java

java
Copy
Edit
package com.example.pos.controller;

import com.example.pos.service.QuestionService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.messaging.simp.SimpMessagingTemplate;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/answer")
public class AnswerController {

    @Autowired
    private SimpMessagingTemplate messagingTemplate;

    @Autowired
    private QuestionService questionService;

    @PostMapping
    public void receiveAnswer(@RequestParam String answer, @RequestParam String field) {
        if ("No".equalsIgnoreCase(answer)) {
            // å‘é€é”™è¯¯ä¿¡æ¯ç»™è¥ä¸šå‘˜
            messagingTemplate.convertAndSend("/topic/error", "ç”¨æˆ·æ‹’ç»: " + field);
        } else {
            // å‘é€ä¸‹ä¸€ä¸ªé—®é¢˜
            messagingTemplate.convertAndSend("/topic/question", questionService.getNextQuestion().orElse(null));
        }
    }
}
ğŸ”¹ 7. è¿è¡Œé¡¹ç›®
bash
Copy
Edit
mvn spring-boot:run
åç«¯å¯åŠ¨åï¼š

/api/question/nextï¼šè·å–å½“å‰é—®é¢˜
/api/answer?answer=Yes&field=nameï¼šPOS æœºå›ç­” "Yes" ç»§ç»­
/api/answer?answer=No&field=addressï¼šPOS æœºå›ç­” "No" è®©è¥ä¸šå‘˜ä¿®æ”¹
ğŸ”¹ 8. POS æœºå¦‚ä½•è¯·æ±‚é—®é¢˜ï¼Ÿ
POS æœºä»£ç ï¼ˆpos.htmlï¼‰ï¼š

javascript
Copy
Edit
function fetchNextQuestion() {
    fetch("http://localhost:8080/api/question/next")
        .then(response => response.json())
        .then(data => {
            document.getElementById('question').innerText = data.content;
            document.getElementById('yesBtn').setAttribute("onclick", `sendAnswer('Yes', '${data.field}')`);
            document.getElementById('noBtn').setAttribute("onclick", `sendAnswer('No', '${data.field}')`);
        });
}

function sendAnswer(answer, field) {
    fetch(`http://localhost:8080/api/answer?answer=${answer}&field=${field}`, { method: "POST" })
        .then(() => fetchNextQuestion());
}

// åŠ è½½ç¬¬ä¸€ä¸ªé—®é¢˜
fetchNextQuestion();
ğŸ“Œ ç»“æœ
è¥ä¸šå‘˜å¡«å†™ä¿¡æ¯
POS æœºæ˜¾ç¤ºç¬¬ä¸€ä¸ªé—®é¢˜
POS æœºç”¨æˆ·å›ç­” "Yes"
è¿”å›ä¸‹ä¸€ä¸ªé—®é¢˜
POS æœºç”¨æˆ·å›ç­” "No"
WebSocket é€šçŸ¥è¥ä¸šå‘˜ä¿®æ”¹
æ‰€æœ‰é—®é¢˜å®Œæˆï¼ŒPOS æœºæ˜¾ç¤º "æ‰€æœ‰é—®é¢˜å·²å®Œæˆ"
ğŸ“Œ æ€»ç»“
âœ… æ¯æ¬¡è°ƒç”¨ API åªè¿”å›ä¸€ä¸ªé—®é¢˜
âœ… POS æœºå›ç­” "Yes" è¿›å…¥ä¸‹ä¸€ä¸ªé—®é¢˜
âœ… POS æœºå›ç­” "No" è®©è¥ä¸šå‘˜ä¿®æ”¹
âœ… åç«¯ç”¨ JSON æ¨¡æ‹Ÿæ•°æ®åº“
âœ… POS æœº WebSocket å®æ—¶äº¤äº’

ä½ å¯ä»¥ç›´æ¥è¿è¡Œä»£ç ï¼Œçœ‹çœ‹æ˜¯å¦ç¬¦åˆä½ çš„éœ€æ±‚ï¼ ğŸš€
